{"version":3,"file":"index.js","sourceRoot":"","sources":["../../../src/utils/index.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Address, Chain, Hash, Hex } from \"viem\";\nimport { encodeAbiParameters, hexToBigInt, keccak256, toHex } from \"viem\";\nimport * as chains from \"viem/chains\";\nimport type {\n  BigNumberish,\n  Percentage,\n  PromiseOrValue,\n  UserOperationRequest,\n} from \"../types.js\";\nimport { BigNumberishSchema, PercentageSchema } from \"./schema.js\";\n\n/**\n * Utility method for converting a chainId to a {@link Chain} object\n *\n * @param chainId\n * @returns a {@link Chain} object for the given chainId\n * @throws if the chainId is not found\n */\nexport const getChain = (chainId: number): Chain => {\n  for (const chain of Object.values(chains)) {\n    if (chain.id === chainId) {\n      return chain;\n    }\n  }\n  throw new Error(\"could not find chain\");\n};\n\n/**\n * Utility function that allows for piping a series of async functions together\n *\n * @param fns - functions to pipe\n * @returns result of the pipe\n */\nexport const asyncPipe =\n  <S, O, F>(...fns: ((s: S, o?: O, f?: F) => Promise<S>)[]) =>\n  async (s: S, o?: O, f?: F) => {\n    let result = s;\n    for (const fn of fns) {\n      result = await fn(result, o, f);\n    }\n    return result;\n  };\n\n// based on @ethersproject/properties, but pulled in here to minize the dependency on ethers\nexport type Deferrable<T> = {\n  [K in keyof T]: PromiseOrValue<T[K]>;\n};\n\n/**\n * Await all of the properties of a {@link Deferrable} object\n *\n * @param object - a {@link Deferrable} object\n * @returns the object with its properties resolved\n */\nexport async function resolveProperties<T>(object: Deferrable<T>): Promise<T> {\n  const promises = Object.keys(object).map((key) => {\n    const value = object[key as keyof Deferrable<T>];\n    return Promise.resolve(value).then((v) => ({ key: key, value: v }));\n  });\n\n  const results = await Promise.all(promises);\n\n  return results.reduce((accum, curr) => {\n    accum[curr.key as keyof T] = curr.value;\n    return accum;\n  }, {} as T);\n}\n\n/**\n * Recursively converts all values in an object to hex strings\n *\n * @param obj - obj to deep hexlify\n * @returns object with all of its values hexlified\n */\nexport function deepHexlify(obj: any): any {\n  if (typeof obj === \"function\") {\n    return undefined;\n  }\n  if (obj == null || typeof obj === \"string\" || typeof obj === \"boolean\") {\n    return obj;\n  } else if (typeof obj === \"bigint\") {\n    return toHex(obj);\n  } else if (obj._isBigNumber != null || typeof obj !== \"object\") {\n    return toHex(obj).replace(/^0x0/, \"0x\");\n  }\n  if (Array.isArray(obj)) {\n    return obj.map((member) => deepHexlify(member));\n  }\n  return Object.keys(obj).reduce(\n    (set, key) => ({\n      ...set,\n      [key]: deepHexlify(obj[key]),\n    }),\n    {}\n  );\n}\n\n/**\n * Generates a hash for a UserOperation valid from entrypoint version 0.6 onwards\n *\n * @param request - the UserOperation to get the hash for\n * @param entryPointAddress - the entry point address that will be used to execute the UserOperation\n * @param chainId - the chain on which this UserOperation will be executed\n * @returns the hash of the UserOperation\n */\nexport function getUserOperationHash(\n  request: UserOperationRequest,\n  entryPointAddress: Address,\n  chainId: bigint\n): Hash {\n  const encoded = encodeAbiParameters(\n    [{ type: \"bytes32\" }, { type: \"address\" }, { type: \"uint256\" }],\n    [keccak256(packUo(request)), entryPointAddress, chainId]\n  ) as `0x${string}`;\n\n  return keccak256(encoded);\n}\n\nfunction packUo(request: UserOperationRequest): Hex {\n  const hashedInitCode = keccak256(request.initCode);\n  const hashedCallData = keccak256(request.callData);\n  const hashedPaymasterAndData = keccak256(request.paymasterAndData);\n\n  return encodeAbiParameters(\n    [\n      { type: \"address\" },\n      { type: \"uint256\" },\n      { type: \"bytes32\" },\n      { type: \"bytes32\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"uint256\" },\n      { type: \"bytes32\" },\n    ],\n    [\n      request.sender as Address,\n      hexToBigInt(request.nonce),\n      hashedInitCode,\n      hashedCallData,\n      hexToBigInt(request.callGasLimit),\n      hexToBigInt(request.verificationGasLimit),\n      hexToBigInt(request.preVerificationGas),\n      hexToBigInt(request.maxFeePerGas),\n      hexToBigInt(request.maxPriorityFeePerGas),\n      hashedPaymasterAndData,\n    ]\n  );\n}\n\n// borrowed from ethers.js\nexport function defineReadOnly<T, K extends keyof T>(\n  object: T,\n  key: K,\n  value: T[K]\n): void {\n  Object.defineProperty(object, key, {\n    enumerable: true,\n    value: value,\n    writable: false,\n  });\n}\n\nexport function isBigNumberish(x: any): x is BigNumberish {\n  return x != null && BigNumberishSchema.safeParse(x).success;\n}\n\nexport function isPercentage(x: any): x is Percentage {\n  return x != null && PercentageSchema.safeParse(x).success;\n}\n\nexport function filterUndefined(\n  obj: Record<string, unknown>\n): Record<string, unknown> {\n  Object.keys(obj).forEach((key) => {\n    if (obj[key] == null) {\n      delete obj[key];\n    }\n  });\n  return obj;\n}\n\nexport function pick(obj: Record<string, unknown>, keys: string | string[]) {\n  return Object.keys(obj)\n    .filter((k) => keys.includes(k))\n    .reduce((res, k) => Object.assign(res, { [k]: obj[k] }), {});\n}\n\nexport * from \"./bigint.js\";\nexport * from \"./defaults.js\";\nexport * from \"./schema.js\";\nexport type * from \"./types.js\";\nexport * from \"./userop.js\";\n"]}